<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Certificate - EventSphere</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    #certificate-box {
      border: 5px solid #555;
      padding: 40px;
      width: 100%;
      max-width: 800px;
      margin: 40px auto;
      background-color: #fffdf6;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      text-align: center;
    }
    #certificate-box h1 {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    #certificate-box p {
      font-size: 18px;
      margin: 10px 0;
    }
    #download-btn {
      margin: 30px auto;
      display: block;
    }
  </style>
</head>
<body>

  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">EventSphere - Certificate</a>
      <a href="student-dashboard.html" class="btn btn-outline-light">Back to Dashboard</a>
    </div>
  </nav>

  <div id="certificate-box">
    <h1>Certificate of Participation</h1>
    <p>This is to certify that</p>
    <h2 id="student-name"><strong>Loading...</strong></h2>
    <p>has participated in</p>
    <h3 id="event-name"><strong>Loading...</strong></h3>
    <p>held on <strong><span id="event-date">Date</span></strong> at <strong>ABC University</strong>.</p>
  </div>
  <button id="download-btn" class="btn btn-primary">Download Certificate</button>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- Dynamic Content -->
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const name = localStorage.getItem("name") || "Participant";
      const eventId = new URLSearchParams(window.location.search).get("id");

      if (!eventId) {
        alert("⚠️ No event ID provided.");
        return;
      }

      document.getElementById("student-name").innerText = name;

      try {
        const res = await fetch("http://localhost:3000/api/events");
        const events = await res.json();
        const event = events.find(e => e._id === eventId);

        if (!event) return alert("❌ Event not found.");

        document.getElementById("event-name").innerText = event.title;
        document.getElementById("event-date").innerText = event.date;

      } catch (err) {
        alert("❌ Failed to load event details.");
      }
    });

    // Download PDF
    document.getElementById("download-btn").addEventListener("click", () => {
      const element = document.getElementById("certificate-box");
      html2pdf().from(element).save("certificate.pdf");
    });
  </script>

</body>
</html>
